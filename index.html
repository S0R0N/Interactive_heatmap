<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Interactive Heatmaps Plus Network</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    
    <body>
        <style>
            .sticky {
                position: fixed;
                top: 0;
                width: 100%
            }
        </style>
        <div class="sticky">
                
        </div>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script>
//          //##################################################################
            //##                  Variables for the main layout               ##
            //##################################################################            
            let margin             = {top: 30, right: 30, bottom: 30, left: 30};// margenes
            let b_width            = 1000 - margin.left - margin.right;         // ancho
            let b_height           = 1000 - margin.top - margin.bottom;       // altura
            let top_banner_width   = b_width;
            let top_banner_heigth  = 200;
            let sample_name_heigth = 60;
            let navbar_heigth      = 56;
            let wrapperWidth       = Math.min(b_width, b_height) * 0.6;   // space for the network and the heatmap
            let Y_link_lenght      = 100;                                    // total network size
            let link_margin        = 5;                                    // space between the heatmap and network
            let heatmapWidth       = wrapperWidth - (Y_link_lenght + link_margin);// Ancho del espacio para el heatmap
            let counter            = 0;
            let at                 = 600; //milliseconds of animation
            let legend_heigth      = 40;

            
//var mousePosition;                                      // la posicion del mouse para el onhover
//          
            /// CREATING THE MAIN SVG or CANVAS
            /*d3.select("body")
                    .style("width",b_width)
                    .style("heigth",b_height)
                    .style("overflow","scroll")
            ;*/
            //
            d3.select("body")
                    .style("margin", 0+"px")
                    .style("font-family", '-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"')
                    .style("font-size", 1+"rem")
                    .style("font-weight",400)
                    .style("line-heigth", 1.5)
                    .style("color", "#212529")
                    .style("text-align","left")
                    .style("background-color", "#fff")
            ;
    //##########################################################################
    //##                     DRAWING THE NAVIGATION BAR                       ##
    //##########################################################################
            let navb = d3.select("body")
                    .append("nav")
                        .style("box-sizing", "border-box")
                        .style("position","fixed")
                        .style("top",0)
                        .style("right",0)
                        .style("left",0)
                        .style("z-index",1000)
                        .style("background-color","#343a40")
                        .style("padding-top",0.5+"rem")
                        .style("padding-right",1+"rem")
                        .style("padding-bottom",0.5+"rem")
                        .style("padding-left",1+"rem")
                        .style("align-items", "center")
                        .style("height",navbar_heigth+"px")
                        .style("list-style","none")
                        
                    //.style("width",1.5+"em")
            ;
            navb.append("a")
                    .attr("href","#")
                    .style("color","#fff")
                    .style("display", "inline-block")
                    .style("margin-right", 1+"rem")
                    .style("font-size", 1.25+"rem")
                    .style("line-height", "inherith")
                    .style("white-space", "nowrap")
                    .style("text-decoration", "none")
                    .style("background-color", "transparent")
                    .text("MicromedaViz-Interactive Heatmap")
            ;
            navb.append("div")
                    .style("display","inline-block")
                    .append("button")
                        .attr("class", "rb")
                        .attr("type", "button")
                        //.attr("disabled", "true")
                        /*.attr("data-toggle","collapse")
                        .attr("data-target","#navBarSupportedContent")
                        .attr("aria-controls","navbarSupportedContent")
                        .attr("aria-expanded","false")
                        .attr("aria-label","Toggle navigation")*/
                        
                        //STYLES
                        .style("color","#28a745")
                        .style("outline","none")
                        .style("background-color","transparent")
                        .style("border-width","2px")
                        .style("border-style","double")
                        .style("border-color","#28a745")
                        .style("line-height", "1.5")
                        .style("border-radius", ".25rem")
                        .style("display","inline-block")
                        .style("text-decoration", "none")

                        // Class btn from the javascript
                        .style("display","inline-block")
                        .style("font-weight",400)
                        .style("text-align","center")
                        .style("white-space","nowrap")
                        .style("vertical-align","middle")
                        .style("-webkit-user-select","none")
                        .style("-moz-user-select","none")
                        .style("-ms-user-select","none")
                        .style("-user-select","none")
                        .style("padding-top", ".375rem")
                        .style("padding-bottom", ".375rem")
                        .style("padding-left", ".75rem")
                        .style("padding-right", ".75rem")
                        .style("font-size", "1rem")
                        .text("Reset")
                        .on('mouseover', function() {
                            //console.log("onmouseover");
                            navb.select(".rb")
                                .transition()
                                .duration(200)
                                .style("background-color", "#28a745")
                                .style("color","#fff");
                            }
                        )
                        .on('mouseout', function() {
                            //console.log("onmouseout");
                            navb.select(".rb")
                                .transition()
                                .duration(200)
                                .style("background-color", "transparent")
                                .style("color","#28a745");
                            }
                        )
            /*let navb2 = navb.append("div")
                    .attr("class","collapse")
                    .attr("id", "navbarSupportedContent")
                    .style("display","flex")
                    .style("-webkit-box-direction","normal")
                    .style("flex-basis","auto")
                    .style("-webkit-box-flex",1)
                    .style("flex-grow",1)
                    .style("-webkit-box-align","center")
                    .style("align-items","center")
                    .append("ul")
                        .style("-webkit-box-orient","horizontal")
                        .style("-webkit-box-direction","normal")
                        .style("flex-direction","row")
                        .style("margin-top",0)
                        .style("margin-right","auto")
                        .append("li")
                            .style("box-sizing","border-box")
                            .style("display","list-item")
                            .style("text-align","-webkit-match-parent")
                            .append("button")
                                .attr("type","button")
                                .style("cursor","pointer")
                                .style("-webkit-appearance","button")
                                .style("color","#28a745")
                                .style("background-color","transparent")
                                .style("background-image","none")
                                .style("border-color","#28a745")
                                .text("Reset")*/
                    
            ;
    //##########################################################################
    //##                     DRAWING THE TOP BANNER                           ##
    //##########################################################################
            let svg1 = d3.select("body")
                .append("div")
                .attr("class","svg1")
                .style('position','fixed')
                .style('top',(navbar_heigth+ margin.top)+"px")
                .style("width","100%")
                .style("z-index",10)
                .style("background-color","rgba(255, 255, 255, 0.70")
                //.attr("transform", "translate("+ (0) + "," + (10) + ")")// se divide entre dos para colocarlo en la mitad
                    .append("svg")
                    .attr("width", top_banner_width + margin.left + margin.right )
                    .attr("height", top_banner_heigth + margin.top + margin.bottom )
            ;
                
            let heatColor = d3.scaleOrdinal()
                            .domain(['YES','PARTIAL','NO'])
                            .range(['#c51b8a','#fa9fb5','#fff'])
            ;
                    
            let top_banner_inside = svg1.append('g')
                    .attr('class', 'top_banner_in')
                    .attr('transform', 'translate('+ (0) + ',' + (0) + ')')// se divide entre dos para colocarlo en la mitad
            ;
                    
            let legends = top_banner_inside.append('g').attr('class', 'legends')
                //.attr('transform', 'translate('+ ((b_width - wrapperWidth) / 2) + ',' + ((b_height - wrapperWidth) / 2) + ')');// se divide entre dos para colocarlo en la mitad
                .attr('transform', 'translate('+ (Y_link_lenght + link_margin) + ',' + (0) + ')')// se divide entre dos para colocarlo en la mitad
                //Trying to make them freeze
            ;
            let GLegends = legends.selectAll(".leg")
                    .data(['YES','PARTIAL','NO'])
            ;
            
            GLegends.join(
                    function(enter){
                        let GLegendsEnter = enter.append("g")
                            .attr('class', 'leg');
                        GLegendsEnter.append("rect")
                            .style("stroke", "grey")
                            .style("stroke-width", 1)
                            .attr("height",legend_heigth)
                            .attr("width",legend_heigth)
                            .attr("x", 
                                function(d,i) {
                                        return (((heatmapWidth/3)*i) + ((heatmapWidth/3)/2));
                                    }
                                )
                            .attr("fill",d => heatColor(d));
                        GLegendsEnter.append("text")
                            .attr("x", 
                                function(d,i) {
                                    //return (heatmapWidth/3)*(i);
                                        return (((heatmapWidth/3)*i) + ((heatmapWidth/3)/2) + (legend_heigth+2));
                                    }
                                )
                            .attr("y",legend_heigth/2)
                            .text(d =>d);
                        return(GLegendsEnter);
                    })
            ;
            
            let GxNodes = top_banner_inside.append('g')
                        .attr('class', 'xn')
                        //.attr('transform', 'translate(' + (Y_link_lenght + link_margin) + ',' + (heatmapWidth + 5) + ')');
                        .attr('transform', 'translate(' + (Y_link_lenght + link_margin) + ',' + (top_banner_heigth - sample_name_heigth) + ')')
            ;
            
    //Think an adaptative size of SVG canvas to draw the heatmap. 
    //##########################################################################
    //##                   DRAWING THE TOP HEATMAP                            ##
    //##########################################################################
            let dv = d3.select("body")  
                .append("div")
                .attr("class","svg")
                //.style("overflow","scroll")
                .style("position","absolute")
                .style("top",(navbar_heigth + top_banner_heigth + +  margin.top + margin.top + margin.bottom)+"px")
                .style("z-index",0)
            ;
            let svg = dv
                    .append("svg")
                    .attr("width", b_width + margin.left + margin.right )
                    .attr("height", b_height + margin.top + margin.bottom )
                    //.attr('transform', 'translate('+ (0) + ',' + (top_banner_heigth + margin.top + margin.bottom) + ')')
                    .attr('transform', 'translate('+ (0) + ',' + (margin.top) + ')')
            ;
                /*.on('mousemove', function() {
                    mousePosition = d3.mouse(this);
                    tooltipGroup.attr('transform', 'translate(' + (mousePosition[0] - (150 / 2) + 10) + ',' + (mousePosition[1] + 20) + ')');
                    tooltipText.text(function() {
                        return selectedCell ? '(' + selectedCell.col + ', ' + selectedCell.row + '): value: ' + selectedCell.value : '';
                    });
                });*/    
            // CREATING THE HEATMAP DRAWING SPACE 
            

            let heatmap = svg.append('g').attr('class', 'heatmap')
                //.attr('transform', 'translate('+ ((b_width - wrapperWidth) / 2) + ',' + ((b_height - wrapperWidth) / 2) + ')');// se divide entre dos para colocarlo en la mitad
                //.attr('transform', 'translate('+ (0) + ',' + (legend_heigth) + ')');// se divide entre dos para colocarlo en la mitad
                .attr('transform', 'translate('+ (0) + ',' + (0) + ')');// se divide entre dos para colocarlo en la mitad
                
            let GyLinks = heatmap.append('g')
                    //var yLink = heatmap.append('g')
                        .attr('class', 'yl')
                        .attr('transform', 'translate(' + 1e-6 + ',' + 1e-6 + ')');
            let GyNodes = heatmap.append('g')
                        .attr('class', 'yn')
                        .attr('transform','translate(' + (Y_link_lenght+ heatmapWidth + link_margin + 10) + ',' + (1e-6) + ')');//fixind the position of the labels for the boxes
                
            
            let table = heatmap.append('g').attr('class', 'table')
                    // depronto me toca borrar el Y de linkheight +link_margin, porque no lo tuve en cuenta antes
                    .attr('transform', 'translate(' + (Y_link_lenght + link_margin) + ',' + (0) + ')');
                    //.attr('transform', 'translate(' + (Y_link_lenght + link_margin) + ',' + (Y_link_lenght + link_margin) + ')');
            //##################################################################
            //##                   HELPER FUNCTIONS                           ##
            //##################################################################
            function collapse(d) {
              if(d.children) {
                d._children = d.children;
                d._children.forEach(collapse);
                d.children = null;
              }
            }
            let ptp = false;
            function get_path_to_parent(d) {
                if(ptp ===false){
                    output = "M" + (d.yLinkScaledLenght) + "," + (d.nodeY-1) +" L"+ (d.yLinkScaledLenght) + "," + d.nodeY;
                    //output = "M" + (Y_link_lenght) + "," + d.nodeY;
                    ptp = true;
                }
                if(d.parent) {
                  //create the path there
                    output = output + " L" + d.parent.yLinkScaledLenght + "," + d.nodeY
                                    + " L" + d.parent.yLinkScaledLenght + "," + d.parent.nodeY; 
                    output = output + get_path_to_parent(d.parent);
                }else{
                    ptp = false;
                }
              
              return(output);
            }
            // Toggle children collapse or expansion on click.
            function click(d) {
                
              if (d.children) {
                  d._children = d.children;
                  d.children = null;
                } else {
                  d.children = d._children;
                  d._children = null;
                }
              updateGraph(d);
            }
            function OnMouseOverExpand(d){
                d3.select(this).style("cursor", "zoom-in"); 
            }
            function OnMouseOverCollapse(d){
                d3.select(this).style("cursor", "zoom-out"); 
            }
            function OnMouseOverNoMore(d){
                d3.select(this).style("cursor", "not-allowed"); 
            }
        //######################################################################
        //##            FIRST LOAD THE FILE AND INITALIZE STUFF               ##
        //######################################################################
            d3.json("https://raw.githubusercontent.com/S0R0N/draft_viz/master/data/gp_assignments.json").then(
                    function(res){       
                    //Initializing root
                        //console.log("raw data");
                        //console.log(res);
                        data_h  = d3.hierarchy(res.property_tree,function(d){return d.children;});
                        samples = res.sample_names;
                        function setYLinkScaledLenght(d, y0, k) {
                            //d.yLinkScaledY = (y0 += d.depth) * k;
                            d.yLinkScaledLenght = (y0= (1+d.depth)) * k; //like an X distribution of the links in the Y axis network
                            if (d.children) d.children.forEach(function(d) { setYLinkScaledLenght(d, y0, k); });
                            return(d);
                        }
                        setYLinkScaledLenght(data_h, data_h.depth, Y_link_lenght / data_h.height);
                        data_h.each(collapse);
                        navb.select(".rb")
                                .on("click",function(){
                                      data_h.each(collapse);
                                      updateGraph(data_h);
                                    }
                                );
                        updateGraph(data_h);
                    }
                );
        //######################################################################
        //##                       UDAPTE FUNCTION                            ##
        //######################################################################
                function updateGraph (source){
                    
                    counter = 0;
                    data_h.eachBefore(function(d){
                        d.id = counter;
                        counter++;
                        return(d.id);
                    });
                    // Sorts the nodes in a tree list like way
                    //data_h.sort(function(a, b) { return b.id - a.id;});
                    data_h.sort(function(a, b) { return a.id - b.id ;});
                    //##################################################################
                    //##            Var for to avoid overlap of the labels            ##
                    //##################################################################
                    //var nodeSpaceY = heatmapWidth/data_h.descendants().length;
                    var nodeSpaceY = 20;
                    var nodeSpaceX = heatmapWidth/samples.length;
                   //console.log(nodeSpaceY);
                    data_h.each(function(d){
                        d.nodeY = ((nodeSpaceY)*(d.id+1)) - (nodeSpaceY/2);
                        return(d);
                    });
                    
                    var nodes = data_h.descendants(),
                        links = data_h.descendants();
                    //console.log("nodeSpaceY*nodes.length");
                    //console.log(nodeSpaceY*nodes.length);
                    
                    /*let ssvg = svg.select("svg")
                    .attr("width", b_width + margin.left + margin.right )
                    .attr("height", nodeSpaceY*nodes.length + margin.top + margin.bottom )*/
                    svg
                        .attr("width", b_width + margin.left + margin.right )
                        .attr("height", nodeSpaceY*nodes.length + margin.top + margin.bottom )
                    //.attr('transform', 'translate('+ (0) + ',' + (top_banner_heigth + margin.top + margin.bottom) + ')')
                    //.attr('transform', 'translate('+ (0) + ',' + (0) + ')')
                    ;
                    //console.log("svg");
                    //console.log(svg);
                    
                    
                    var yLink = GyLinks.selectAll('g.link') //IT IS STILL NOT WORKING, HAVE TO CONNECT THE DATA TO THE OBJECTTTTTTT
                            .data(links,function(d,i) {
                                return d.data.property_id;
                            });
                    //##################################################################
                    //##                     DRAWING THE NETWORK                      ##
                    //##################################################################
                        yLink.join(
                            function(enter){
                                var yLinkEnter = enter
                                        .append("g")
                                        .attr('class',function(d) {
                                            return 'link '+ d.data.property_id;}
                                        );
                                yLinkEnter
                                        .append("path")
                                        .attr('class',function(d) {return 'link '+ d.data.property_id;})
                                        .style('fill', 'none')
                                        .style('stroke', '#000')
                                        .style('stroke-width', 1)
                                        .attr("d",function(d){
                                                return get_path_to_parent(d);
                                            });
                                    yLinkEnter.append("circle")
                                        .attr('class',function(d) {return 'link '+ d.data.property_id;})
                                        .attr('r', 2)
                                        .attr("transform", function(d) {
                                          return "translate(" + d.yLinkScaledLenght + "," + d.nodeY + ")";
                                        });
                                    return(yLinkEnter);
                            },
                            function(update){
                                var yLinkUpdate = update;
                                    yLinkUpdate.select("path.link")
                                        .attr("d",function(d){
                                            return get_path_to_parent(d);
                                        });
                                        
                                    yLinkUpdate.select("circle")
                                        .attr("transform", function(d){
                                              return "translate(" + d.yLinkScaledLenght + "," + d.nodeY + ")";
                                            }
                                        );
                                return(yLinkUpdate);
                            },function(exit){
                                var yLinkExit = exit.remove();
                                    yLinkExit.select("g.link");
                                    yLinkExit.select("circle.link")
                                            .attr("r",1e-6);
                                    yLinkExit.select("path.link")
                                            .style('stroke-width', 0);                                    
                                return(yLinkExit);
                            }
                        );
                   // Ynode has the same proble that ylink had, the g element is not being created and the sub elements are flying. Gotta ground them. 
                    //##################################################################
                    //##                     DRAWING THE NETWORK                      ##
                    //##################################################################
                        
                    var yNode = GyNodes.selectAll('g.y-node')
                            .data(nodes,function(d) {
                                return d.data.property_id;
                            });
                        yNode.join(
                            function(enter){
                                let yNodeEnter = enter
                                        .append("g")
                                        .attr('class',function(d) {
                                            return 'y-node '+ d.data.property_id;}
                                        );
                                    yNodeEnter.append("text")
                                        .attr('class',function(d) {
                                            return 'y-node '+ d.data.property_id;}
                                        )
                                        //.attr('transform', function(d) { return 'translate(' + 0 + ',' + (d.nodeY +(nodeSpaceY/2)) + ')'; })
                                        //.attr('transform', function(d) { return 'translate(' + 0 + ',' + (d.nodeY+3) + ')'; })
                                        .attr('transform', function(d) { 
                                            //console.log("d.yLinkScaledLenght");
                                            //console.log(d.yLinkScaledLenght);
                                            return 'translate(' + d.yLinkScaledLenght + ',' + (d.nodeY+3) + ')'; 
                                        })
                                        .attr("font-family", "sans-serif")
                                        .attr("font-size", 12)
                                        .text(function(d) { return d.data.name;})
                                        //.attr('cursor', 'pointer')
                                        .style("fill", function(d) {
                                            return (d.children ? "black": "black");
                                        })
                                        .style("font-weight", function(d) {
                                            return (d.children ? "normal": "bold");
                                        })
                                        .style("font-style", function(d) {
                                            return (d.children ? "italic": "normal");
                                        })
                                        //cursor type
                                        .on('mouseover', function (d){//Changing the cursor appearance 
                                            if(d.children){
                                                d3.select(this).style("cursor", "zoom-out");
                                            }else{
                                                d3.select(this).style("cursor", "zoom-in");
                                            }
                                            if(d.height === 0){
                                                d3.select(this)
                                                    .style("cursor", "not-allowed");
                                                }
                                            }
                                        )
                                        .on('click', click);
                                return(yNodeEnter);
                            },
                            function(update){
                                let yNodeUpdate = update;
                                    yNodeUpdate.select("text")
                                        .style("fill", function(d) {
                                            return (d.children ? "black": "black");
                                        })
                                        .style("font-weight", function(d) {
                                            return (d.children ? "normal": "bold");
                                        })
                                        .style("font-style", function(d) {
                                            return (d.children ? "italic": "normal");
                                        })
                                        .on('mouseover', function (d){//Changing the cursor appearance 
                                            if(d.children){
                                                d3.select(this).style("cursor", "zoom-out");
                                            }else{
                                                d3.select(this).style("cursor", "zoom-in");
                                            }
                                            if(d.height === 0){
                                                d3.select(this)
                                                    .style("cursor", "not-allowed");
                                                }
                                            }
                                        )
                                        //cursor type
                                        //
                                        //.attr('transform', function(d) { return 'translate(' + 0 + ',' + (d.nodeY +(nodeSpaceY/2)) + ')'; });
                                        //.attr('transform', function(d) { return 'translate(' + 0 + ',' + (d.nodeY+3) + ')'; });
                                        .attr('transform', function(d) { return 'translate(' + d.yLinkScaledLenght + ',' + (d.nodeY+3) + ')'; });
                                return(yNodeUpdate);
                            },function(exit){
                                let yNodeExit = exit.remove();
                                    yNodeExit.select("text.link")
                                            .attr("font-size", 0);
                            }
                        );
                
                    var xNode = GxNodes.selectAll('g.x-node')
                        .data(samples);
                        xNode.join(
                            function(enter){
                                let xNodeEnter = enter
                                        .append("g")
                                        .attr('class',"x-node");
                                    xNodeEnter.append("text")
                                        .attr('class',"x-node")
                                        .style("text-anchor", 'start')
                                        .attr("transform", function(d,i) { return "translate(" + ((nodeSpaceX*i) + (nodeSpaceX/2))+ "," + 0 + ")"; })
                                        .attr("font-family", "sans-serif")
                                        .attr("font-size", 12)
                                        .attr("writing-mode", "vertical-rl")
                                        .text(function(d) { return d; });
                                return(xNodeEnter);
                            },
                            function(update){
                                let xNodeUpdate = update;
                                    xNodeUpdate.select("text.x-node")
                                        .attr("transform", function(d,i) { return "translate(" + ((nodeSpaceX*i) + (nodeSpaceX/2))+ "," + 0 + ")"; });
                                return(xNodeUpdate);
                            },function(exit){
                                let xNodeExit = exit.remove();
                                    xNodeExit.select("text.x-node")
                                            .attr("font-size", 0);
                            }
                        );
                    //##################################################################
                    //##                 END DRAWING THE NETWORK                      ##
                    //##################################################################

                    //##################################################################
                    //##                     DRAWING THE BOXES                        ##
                    //##################################################################
                    // Number of columns are the numeber of samples
                    
                    var nCols = samples.length;
                    var bandX = d3.scaleBand()
                            .domain(d3.range(nCols))
                            .range([0, heatmapWidth]);

                    var rows = table.selectAll('.row')
                           .data(nodes,function(d) {
                               return d.data.property_id;
                           });
                    rows.join(
                        function(enter){
                            let rowEnter = enter.append('g')
                                //.attr('class', 'row')
                                .attr('class',function(d) {return 'row '+ d.data.property_id;})
                                .attr('transform', function(d, i) {

                                    return 'translate(0, ' + (d.nodeY- (nodeSpaceY/2)) + ')';
                                });  
                            let rowEnterRect = rowEnter
                                    .selectAll('rect')
                                    .data(function(d) {
                                        return(d.data.result);
                                    });
                            rowEnterRect
                                    .join(
                                        function(enter){
                                            let rowEnterRect = enter.append('rect')
                                                .style('fill', function (d) {return heatColor(d);})
                                                .style('opacity', 0.7)
                                                .attr('x', function(d, i) {return bandX(i);})
                                                .style('stroke', '#000')
                                                .style('stroke-width', 1)
                                                .attr('width', bandX.bandwidth())
                                                .attr('height', nodeSpaceY);
                                                //.attr('height', bandX.bandwidth());
                                            return(rowEnterRect);
                                        }
                                    );
                        },
                        function(update){
                            //no le tengo mucha fe por la division del joing update del objeto children
                            //probably I have to create a group to modify these dudes 
                            //console.log("updating row");
                            let rowUpdate = update;
                                rowUpdate
                                    .attr('transform', function(d, i) {
                                        return 'translate(0, ' + (d.nodeY- (nodeSpaceY/2)) + ')';
                                    });
                                rowUpdate.selectAll('rect')
                                    .style('fill', function (d) {
                                            //console.log("rect data on update");
                                            return heatColor(d);
                                        })
                                    .style('opacity', 0.7)
                                    .attr('x', function(d, i) {return bandX(i);})
                                    .style('stroke', '#000')
                                    .style('stroke-width', 1)
                                    .attr('width', bandX.bandwidth())
                                    .attr('height', nodeSpaceY);
                                    //.attr('height', bandX.bandwidth());
                                    //.attr('height', bandY.bandwidth());
                        },
                        function(exit){
                            let rowExit = exit.remove();
                                rowExit.selectAll("rect")
                                    .style('stroke', '#fff')
                                    .style('stroke-width', 1e-6)
                                    .attr('width', 1e-6)
                                    .attr('height', 1e-6);
                            return(rowExit);
                        }
                    );
                };
         
            
        </script>
    </body>
</html>
